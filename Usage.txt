The pipeline for non-reference retrotransposon insertion polymorphisms (RIPs) calling of human in this program includes 2 steps.

=== STEP 1 ===

The first step collects informative reads and generates other necessary files for step 2.
We use 01discordant_v2.pl to accomplish this function.

Usage: perl 01discordant_v2.pl -bamlist <string> -refTEs <string> [-outDir <string>] [-nosort] [-temp] [-split] [-name]

       -bamlist  A file include all bamfile names prepared to beed processed (one BAM per line)
       -refTEs   TE reference file (with its BLAST index in the same dir)
       [-outDir  Appoint the output directory]
       [-nosort  Input bam file is nosorted. Default is sorted]
       [-temp    Do not remove intermediate output files. Default is to cleanup]
       [-nosplit If the input bamfiles haven't been splited by RG library,please choose it.If you choose -nosplit,please ensure there is only one BAM in bamlist.]
       [-name    If you input mulit files, you can appoint the name of result file. Default is unknown.]

Note: 
1. 01discordant_v2.pl requires samtools(v1.0 or later), BLAST (v2.2.15 or later).
2. Samtools and BLAST should be exported to .bashrc before running SID. 
3. The BAM file as input should have XT/X1/MD tags. If the bamlist contain more than 1 file, the BAM should have RG tag.

Example:
perl 01discordant_v2.pl -bamlist BamList.txt -refTEs TE.fa -outDir /USER/TE/TEST -nosplit -name Human_TE

=== STEP 2 ===

The second step discovers the specific insertion site and outputs the final results into a plain text.
We use 02cluster.pl to accomplish this function.

Usage: perl 02cluster.pl -uniqueBam <string> -Bam <string> -fastaref <string> -info <string> -m8file <string> -outfile <string>

       -uniqueBam     Unique Bam file generated by step 1
       -Bam           Total bam file (a merged BAM file of the step 1's bamList )
       -fastaref      Reference fasta files
       -info          Info file generated by step 1
       -m8file        M8 repeat file generated by step 1
       -outfile       Outfile (a plain text)

Note:
1. 02cluster.pl requires samtools(v0.1.18), BLAST to be in the default path.
2. The resulting file may contain some queries without specific insertion site, you should remove them by hand at present. We will optimize the output soon.

Example:
perl 02cluster.pl -uniqueBam NA18537.lst.unique.srt.rmdup.bam  \
                  -Bam NA18537.sort.bam \
                  -fastaref human.fasta \
                  -info NA18537.lst.info \
                  -m8file NA18537.lst.repeat.m8 \
                  -outfile NA18537.TE.list

The format of output file:
There are 25 columns in the output file. Below is the detailed information.

column explanation   example
1	chromosome	chr1
2	site of TSD at 5' end	8446628
3	site of TSD at 3' end	8446635
4	supporting clipped reads at 5' end	7
5	supporting clipped reads at 3' end	12
6	length of TSD sequence	8
7	# of mismatches that spanning TSD	5
8	polyA/T around TSD	2
9	TSD sequence	GAACTCTT
10	Total # of supporting reads at 5' end	L:19
11	Total # of supporting reads at 3' end	R:23
12	heterozygosity	HET:1
13	score of confidence	62.50
14	Block and TSD are at one end or two	BdTd
15	site of Block at 5' end	8446212
16	site of Block at 3' end	8447074
17	supporting reads of Block at 5' end	13
18	supporting reads of Block at 3' end	20
19	type of TE	Alu
20	type of TE (detailed)	Alu:Alu:Alu:Alu:Alu:Alu:Alu:Alu:Alu
@L1:L1:L1
21	Block info	1
22	IDs of supporting reads of Block at 5' end	A81ED5ABXX:7:2201:1708:77141#0*
23	IDs of supporting reads of Block at 3' end	B81ECYABXX:6:1105:19303:80682#0*
24	IDs of supporting clipped reads at 5' end	FC81C71ABXX:6:1201:14760:54208
#NNNNNNNN*
25	IDs of supporting clipped reads at 3' end	FC81C71ABXX:8:1203:14052:72292
#GNNNNCNN*

For column 8,  '0' means no polyA/T at both ends of TSD. '1' means there is polyA/T at 5' end of TSD. '2' means there is polyA/T at 3' end of TSD. '3' means there are polyA/T sequences at both ends of TSD.
Column 14 shows the Block/TSD exists atÂ one end or both ends. 'B' refers to Block. 'd' refers to 'exist at both ends'. 'T' refers to TSD. 's' refers to 'exist at single end'.
Column 21 shows the orientation of Block. '1' means Blocks are pairwised and have opposite directions. '2' means the Block is single and in positive direction. '3' means the Block is single and in negative direction. '5' means the Block is single and the orientation is unknown.
